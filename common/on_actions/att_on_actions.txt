on_actions = {
    on_daily = {
        effect = {
            every_country = {
				if = {
					limit = {
                        is_ai = no
						check_variable = {
							auto_trade_disabled = 0
						}
                    }

					### Tradet	

					# RUBBER
	            	if = {
                    	limit = {
							check_variable = { resource@rubber < 0 }
                    	}
						set_temp_variable = { import_needed = -1 }
						multiply_temp_variable = { import_needed = resource@rubber }
						add_to_temp_variable = { import_needed = resource_imported@rubber }

						set_temp_variable = { import_needed_remainder = import_needed }
						modulo_temp_variable = { import_needed_remainder = 8 }
						if = {
							limit = {
								check_variable = { import_needed_remainder > 0 }
							}
							subtract_from_temp_variable = { import_needed = import_needed_remainder }
							add_to_temp_variable = { import_needed = 8  }
						}
                    	
						get_sorted_scored_countries_temp = {
							scorer = best_trader_rubber_scorer  
							array  = tags
							scores = resources
						}

						for_each_loop = {
							array = tags
							value = trader
							break = break
							if = {
        						limit = {
									NOT = {
										check_variable = { trader = FROM }
									}
        						}
								if = {
									limit = {
										check_variable = { import_needed < 1 }
									}
									set_temp_variable = { break = 1 }
								}
								else = {
									set_temp_variable = { export_max = 0 }

									var:trader = {
										add_to_temp_variable = { export_max = resource_exported@rubber }
									}

									if = {
										limit = {
											check_variable = { export_max < import_needed }
										}
										set_temp_variable = { traded_resources = export_max }
									}
									else = {
										set_temp_variable = { traded_resources = import_needed }
									}

									set_temp_variable = { temp_traded_resources = traded_resources }
									modulo_temp_variable = { temp_traded_resources = 8}
									if = {
										limit = {
											check_variable = { temp_traded_resources > 0 }
										}
										subtract_from_temp_variable = { traded_resources = temp_traded_resources }
									}
									clamp_temp_variable = {
										var = traded_resources
										min = 8
									}

									set_temp_variable = {temp_traded_resources = traded_resources}
									modulo_temp_variable = {temp_traded_resources = 8}
									if = {
										limit = {
											check_variable = {temp_traded_resources > 0}
										}
										subtract_from_temp_variable = {traded_resources = temp_traded_resources}
									}
									clamp_temp_variable = {
										var = traded_resources
										min = 8
									}

									meta_effect = {
										text = {
											create_import = {
												resource = rubber
												amount = [AMOUNT]
												exporter = [EXPORTER]
											}											
										}
										AMOUNT = "[?traded_resources]"
										EXPORTER = "[?trader.GetTag]"
									}

									subtract_from_temp_variable = { import_needed = traded_resources }
								}
    						}		
						}
                	}

					# ALUMINIUM
	            	if = {
                    	limit = {
                        	check_variable = { resource@aluminium < 0 }
                    	}
                    	set_temp_variable = { import_needed = -1 }
						multiply_temp_variable = { import_needed = resource@aluminium }
						add_to_temp_variable = { import_needed = resource_imported@aluminium }

						set_temp_variable = { import_needed_remainder = import_needed }
						modulo_temp_variable = { import_needed_remainder = 8 }
						if = {
							limit = {
								check_variable = { import_needed_remainder > 0 }
							}
							subtract_from_temp_variable = { import_needed = import_needed_remainder }
							add_to_temp_variable = { import_needed = 8  }
						}

						get_sorted_scored_countries_temp = {
							scorer = best_trader_aluminium_scorer  
							array  = tags
							scores = resources
						}
						for_each_loop = {
							array = tags
							value = trader
							break = break
							if = {
        						limit = {
									NOT = {
										check_variable = { trader = FROM }
									}
        						}
								if = {
									limit = {
										check_variable = { import_needed < 1 }
									}
									set_temp_variable = { break = 1 }
								}
								else = {
									set_temp_variable = { export_max = 0 }

									var:trader = {
										add_to_temp_variable = { export_max = resource_exported@aluminium }
									}

									if = {
										limit = {
											check_variable = { export_max < import_needed }
										}
										set_temp_variable = { traded_resources = export_max }
									}
									else = {
										set_temp_variable = { traded_resources = import_needed }
									}

									set_temp_variable = { temp_traded_resources = traded_resources }
									modulo_temp_variable = { temp_traded_resources = 8}
									if = {
										limit = {
											check_variable = { temp_traded_resources > 0 }
										}
										subtract_from_temp_variable = { traded_resources = temp_traded_resources }
									}
									clamp_temp_variable = {
										var = traded_resources
										min = 8
									}

									set_temp_variable = {temp_traded_resources = traded_resources}
									modulo_temp_variable = {temp_traded_resources = 8}
									if = {
										limit = {
											check_variable = {temp_traded_resources > 0}
										}
										subtract_from_temp_variable = {traded_resources = temp_traded_resources}
									}
									clamp_temp_variable = {
										var = traded_resources
										min = 8
									}

									meta_effect = {
										text = {
											create_import = {
												resource = aluminium
												amount = [AMOUNT]
												exporter = [EXPORTER]
											}											
										}
										AMOUNT = "[?traded_resources]"
										EXPORTER = "[?trader.GetTag]"
									}

									subtract_from_temp_variable = { import_needed = traded_resources }
								}
    						}
						}
					}

					# TUNGSTEN
					if = {
                    	limit = {
                        	check_variable = { resource@tungsten < 0 }
                    	}
                    	set_temp_variable = { import_needed = -1 }
                        multiply_temp_variable = { import_needed = resource@tungsten }
                        add_to_temp_variable = { import_needed = resource_imported@tungsten }

						set_temp_variable = { import_needed_remainder = import_needed }
						modulo_temp_variable = { import_needed_remainder = 8 }
						if = {
							limit = {
								check_variable = { import_needed_remainder > 0 }
							}
							subtract_from_temp_variable = { import_needed = import_needed_remainder }
							add_to_temp_variable = { import_needed = 8  }
						}

						get_sorted_scored_countries_temp = {
							scorer = best_trader_tungsten_scorer  
							array  = tags
							scores = resources
						}
						for_each_loop = {
							array = tags
							value = trader
							break = break
							if = {
        						limit = {
									NOT = {
										check_variable = { trader = FROM }
									}
        						}
								if = {
									limit = {
										check_variable = { import_needed < 1 }
									}
									set_temp_variable = { break = 1 }
								}
								else = {
									set_temp_variable = { export_max = 0 }

									var:trader = {
										add_to_temp_variable = { export_max = resource_exported@tungsten }
									}

									if = {
										limit = {
											check_variable = { export_max < import_needed }
										}
										set_temp_variable = { traded_resources = export_max }
									}
									else = {
										set_temp_variable = { traded_resources = import_needed }
									}

									set_temp_variable = { temp_traded_resources = traded_resources }
									modulo_temp_variable = { temp_traded_resources = 8}
									if = {
										limit = {
											check_variable = { temp_traded_resources > 0 }
										}
										subtract_from_temp_variable = { traded_resources = temp_traded_resources }
									}
									clamp_temp_variable = {
										var = traded_resources
										min = 8
									}

									set_temp_variable = {temp_traded_resources = traded_resources}
									modulo_temp_variable = {temp_traded_resources = 8}
									if = {
										limit = {
											check_variable = {temp_traded_resources > 0}
										}
										subtract_from_temp_variable = {traded_resources = temp_traded_resources}
									}
									clamp_temp_variable = {
										var = traded_resources
										min = 8
									}

									meta_effect = {
										text = {
											create_import = {
												resource = tungsten
												amount = [AMOUNT]
												exporter = [EXPORTER]
											}											
										}
										AMOUNT = "[?traded_resources]"
										EXPORTER = "[?trader.GetTag]"
									}

									subtract_from_temp_variable = { import_needed = traded_resources }
								}
    						}
						}
					}

					# STEEL
					if = {
                    	limit = {
                        	check_variable = { resource@steel < 0 }
                    	}
                    	set_temp_variable = { import_needed = -1 }
						multiply_temp_variable = { import_needed = resource@steel }
						add_to_temp_variable = { import_needed = resource_imported@steel }

						set_temp_variable = { import_needed_remainder = import_needed }
						modulo_temp_variable = { import_needed_remainder = 8 }
						if = {
							limit = {
								check_variable = { import_needed_remainder > 0 }
							}
							subtract_from_temp_variable = { import_needed = import_needed_remainder }
							add_to_temp_variable = { import_needed = 8  }
						}

						get_sorted_scored_countries = {
							scorer = best_trader_steel_scorer  
							array  = tags
							scores = resources
						}
						for_each_loop = {
							array = tags
							value = trader
							break = break
							if = {
        						limit = {
									NOT = {
										check_variable = { trader = FROM }
									}
        						}
								if = {
									limit = {
										check_variable = { import_needed < 1 }
									}
									set_temp_variable = { break = 1 }
								}
								else = {
									set_temp_variable = { export_max = 0 }

									var:trader = {
										add_to_temp_variable = { export_max = resource_exported@steel }
									}

									if = {
										limit = {
											check_variable = { export_max < import_needed }
										}
										set_temp_variable = { traded_resources = export_max }
									}
									else = {
										set_temp_variable = { traded_resources = import_needed }
									}

									set_temp_variable = { temp_traded_resources = traded_resources }
									modulo_temp_variable = { temp_traded_resources = 8 }
									if = {
										limit = {
											check_variable = { temp_traded_resources > 0 }
										}
										subtract_from_temp_variable = { traded_resources = temp_traded_resources }
									}
									clamp_temp_variable = {
										var = traded_resources
										min = 8
									}

									set_temp_variable = {temp_traded_resources = traded_resources}
									modulo_temp_variable = {temp_traded_resources = 8}
									if = {
										limit = {
											check_variable = {temp_traded_resources > 0}
										}
										subtract_from_temp_variable = {traded_resources = temp_traded_resources}
									}
									clamp_temp_variable = {
										var = traded_resources
										min = 8
									}

									meta_effect = {
										text = {
											create_import = {
												resource = steel
												amount = [AMOUNT]
												exporter = [EXPORTER]
											}											
										}
										AMOUNT = "[?traded_resources]"
										EXPORTER = "[?trader.GetTag]"
									}

									subtract_from_temp_variable = { import_needed = traded_resources }
								}
    						}
						}
					}

					# CHROMIUM
					if = {
                    	limit = {
                        	check_variable = { resource@chromium < 0 }
                    	}
                    	set_temp_variable = { import_needed = -1 }
                        multiply_temp_variable = { import_needed = resource@chromium }
						add_to_temp_variable = { import_needed = resource_imported@chromium }

						set_temp_variable = { import_needed_remainder = import_needed }
						modulo_temp_variable = { import_needed_remainder = 8 }
						if = {
							limit = {
								check_variable = { import_needed_remainder > 0 }
							}
							subtract_from_temp_variable = { import_needed = import_needed_remainder }
							add_to_temp_variable = { import_needed = 8  }
						}

						get_sorted_scored_countries_temp = {
							scorer = best_trader_chromium_scorer  
							array  = tags
							scores = resources
						}
						for_each_loop = {
							array = tags
							value = trader
							break = break
							if = {
        						limit = {
									NOT = {
										check_variable = { trader = FROM }
									}
        						}
								if = {
									limit = {
										check_variable = { import_needed < 1 }
									}
									set_temp_variable = { break = 1 }
								}
								else = {
									set_temp_variable = { export_max = 0 }

									var:trader = {
										add_to_temp_variable = { export_max = resource_exported@chromium }
									}

									if = {
										limit = {
											check_variable = { export_max < import_needed }
										}
										set_temp_variable = { traded_resources = export_max }
									}
									else = {
										set_temp_variable = { traded_resources = import_needed }
									}

									set_temp_variable = { temp_traded_resources = traded_resources }
									modulo_temp_variable = { temp_traded_resources = 8}
									if = {
										limit = {
											check_variable = { temp_traded_resources > 0 }
										}
										subtract_from_temp_variable = { traded_resources = temp_traded_resources }
									}
									clamp_temp_variable = {
										var = traded_resources
										min = 8
									}

									set_temp_variable = {temp_traded_resources = traded_resources}
									modulo_temp_variable = {temp_traded_resources = 8}
									if = {
										limit = {
											check_variable = {temp_traded_resources > 0}
										}
										subtract_from_temp_variable = {traded_resources = temp_traded_resources}
									}
									clamp_temp_variable = {
										var = traded_resources
										min = 8
									}

									meta_effect = {
										text = {
											create_import = {
												resource = chromium
												amount = [AMOUNT]
												exporter = [EXPORTER]
											}											
										}
										AMOUNT = "[?traded_resources]"
										EXPORTER = "[?trader.GetTag]"
									}

									subtract_from_temp_variable = { import_needed = traded_resources }
								}
    						}
						}
					}

					# COAL
					if = {
                    	limit = {
                        	check_variable = { resource@coal < 0 }
                    	}
                    	set_temp_variable = { import_needed = -1 }
                        multiply_temp_variable = { import_needed = resource@coal }
						add_to_temp_variable = { import_needed = resource_imported@coal }

						set_temp_variable = { import_needed_remainder = import_needed }
						modulo_temp_variable = { import_needed_remainder = 8 }
						if = {
							limit = {
								check_variable = { import_needed_remainder > 0 }
							}
							subtract_from_temp_variable = { import_needed = import_needed_remainder }
							add_to_temp_variable = { import_needed = 8  }
						}

						get_sorted_scored_countries_temp = {
							scorer = best_trader_coal_scorer  
							array  = tags
							scores = resources
						}
						for_each_loop = {
							array = tags
							value = trader
							break = break
							if = {
        						limit = {
									NOT = {
										check_variable = { trader = FROM }
									}
        						}
								if = {
									limit = {
										check_variable = { import_needed < 1 }
									}
									set_temp_variable = { break = 1 }
								}
								else = {
									set_temp_variable = { export_max = 0 }

									var:trader = {
										add_to_temp_variable = { export_max = resource_exported@coal }
									}

									if = {
										limit = {
											check_variable = { export_max < import_needed }
										}
										set_temp_variable = { traded_resources = export_max }
									}
									else = {
										set_temp_variable = { traded_resources = import_needed }
									}

									set_temp_variable = { temp_traded_resources = traded_resources }
									modulo_temp_variable = { temp_traded_resources = 8}
									if = {
										limit = {
											check_variable = { temp_traded_resources > 0 }
										}
										subtract_from_temp_variable = { traded_resources = temp_traded_resources }
									}
									clamp_temp_variable = {
										var = traded_resources
										min = 8
									}

									set_temp_variable = {temp_traded_resources = traded_resources}
									modulo_temp_variable = {temp_traded_resources = 8}
									if = {
										limit = {
											check_variable = {temp_traded_resources > 0}
										}
										subtract_from_temp_variable = {traded_resources = temp_traded_resources}
									}
									clamp_temp_variable = {
										var = traded_resources
										min = 8
									}

									meta_effect = {
										text = {
											create_import = {
												resource = coal
												amount = [AMOUNT]
												exporter = [EXPORTER]
											}											
										}
										AMOUNT = "[?traded_resources]"
										EXPORTER = "[?trader.GetTag]"
									}

									subtract_from_temp_variable = { import_needed = traded_resources }
								}
    						}
						}
					}

					### Cancel Trade

					# RUBBER
					set_temp_variable = { overtrade_value = 7 }
					set_temp_variable = { net_residual_resource = resource_produced@rubber }
					subtract_from_temp_variable = { net_residual_resource = resource_consumed@rubber }
					subtract_from_temp_variable = { net_residual_resource = resource_exported@rubber }

					every_subject_country = {
						if = {
                            limit = {
                                or = {
                                    has_autonomy_state = autonomy_collaboration_government
                                    has_autonomy_state = autonomy_reichskommissariat
                                }
                                check_variable = { resource_exported@rubber > 0 }
                                check_variable = { net_residual_resource > -80 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 87 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
                        if = {
                            limit = {
                                has_autonomy_state = autonomy_dominion
                                check_variable = { resource_exported@rubber > 0 }
                                check_variable = { net_residual_resource > -16 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 23 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
                        if = {
                            limit = {
                                has_autonomy_state = autonomy_satellite
                                check_variable = { resource_exported@rubber > 0 }
                                check_variable = { net_residual_resource > -10 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 17 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
					}
					if = {
						limit = {
							check_variable = { resource@rubber > overtrade_value }
							check_variable = { resource_imported@rubber > 0 }
						}

						get_sorted_scored_countries_temp = {
							scorer = best_trader_rubber_scorer  
							array  = tags
							scores = resources
						}

						for_each_loop = {
							array = tags
							value = trader
							break = break
							meta_effect = {
								text = {
									create_import = {
										resource = rubber
										amount = 0
										exporter = [EXPORTER]
									}											
								}
								EXPORTER = "[?trader.GetTag]"
							}
						}				
					}

					# ALUMINIUM
					set_temp_variable = { overtrade_value = 7}
					set_temp_variable = { net_residual_resource = resource_produced@aluminium }
					subtract_from_temp_variable = { net_residual_resource = resource_consumed@aluminium }
					subtract_from_temp_variable = { net_residual_resource = resource_exported@aluminium }

					every_subject_country = {
						if = {
                            limit = {
                                or = {
                                    has_autonomy_state = autonomy_collaboration_government
                                    has_autonomy_state = autonomy_reichskommissariat
                                }
                                check_variable = { resource_exported@aluminium > 0 }
                                check_variable = { net_residual_resource > -80 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 87 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
                        if = {
                            limit = {
                                has_autonomy_state = autonomy_dominion
                                check_variable = { resource_exported@aluminium > 0 }
                                check_variable = { net_residual_resource > -16 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 23 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
                        if = {
                            limit = {
                                has_autonomy_state = autonomy_satellite
                                check_variable = { resource_exported@aluminium > 0 }
                                check_variable = { net_residual_resource > -10 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 17 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
					}
					if = {
						limit = {
							check_variable = { resource@aluminium > overtrade_value }
							check_variable = { resource_imported@aluminium > 0 }
						}
						get_sorted_scored_countries_temp = {
							scorer = best_trader_aluminium_scorer  
							array  = tags
							scores = resources
						}

						for_each_loop = {
							array = tags
							value = trader
							break = break
							meta_effect = {
								text = {
									create_import = {
										resource = aluminium
										amount = 0
										exporter = [EXPORTER]
									}											
								}
								EXPORTER = "[?trader.GetTag]"
							}
						}				
					}

					# TUNGSTEN
					set_temp_variable = { overtrade_value = 7}
					set_temp_variable = { net_residual_resource = resource_produced@tungsten }
					subtract_from_temp_variable = { net_residual_resource = resource_consumed@tungsten }
					subtract_from_temp_variable = { net_residual_resource = resource_exported@tungsten }

					every_subject_country = {
						if = {
                            limit = {
                                or = {
                                    has_autonomy_state = autonomy_collaboration_government
                                    has_autonomy_state = autonomy_reichskommissariat
                                }
                                check_variable = { resource_exported@tungsten > 0 }
                                check_variable = { net_residual_resource > -80 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 87 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
                        if = {
                            limit = {
                                has_autonomy_state = autonomy_dominion
                                check_variable = { resource_exported@tungsten > 0 }
                                check_variable = { net_residual_resource > -16 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 23 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
                        if = {
                            limit = {
                                has_autonomy_state = autonomy_satellite
                                check_variable = { resource_exported@tungsten > 0 }
                                check_variable = { net_residual_resource > -10 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 17 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
					}
					if = {
						limit = {
							check_variable = { resource@tungsten > overtrade_value }
							check_variable = { resource_imported@tungsten > 0 }
						}
						get_sorted_scored_countries_temp = {
							scorer = best_trader_tungsten_scorer  
							array  = tags
							scores = resources
						}

						for_each_loop = {
							array = tags
							value = trader
							break = break
							meta_effect = {
								text = {
									create_import = {
										resource = tungsten
										amount = 0
										exporter = [EXPORTER]
									}											
								}
								EXPORTER = "[?trader.GetTag]"
							}
						}					
					}

					# STEEL
					set_temp_variable = { overtrade_value = 7 }
					set_temp_variable = { net_residual_resource = resource_produced@steel }
					subtract_from_temp_variable = { net_residual_resource = resource_consumed@steel }
					subtract_from_temp_variable = { net_residual_resource = resource_exported@steel }

					every_subject_country = {
						if = {
                            limit = {
                                or = {
                                    has_autonomy_state = autonomy_collaboration_government
                                    has_autonomy_state = autonomy_reichskommissariat
                                }
                                check_variable = { resource_exported@steel > 0 }
                                check_variable = { net_residual_resource > -80 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 87 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
                        if = {
                            limit = {
                                has_autonomy_state = autonomy_dominion
                                check_variable = { resource_exported@steel > 0 }
                                check_variable = { net_residual_resource > -16 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 23 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
                        if = {
                            limit = {
                                has_autonomy_state = autonomy_satellite
                                check_variable = { resource_exported@steel > 0 }
                                check_variable = { net_residual_resource > -10 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 17 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
					}
					if = {
						limit = {
							check_variable = { resource@steel > overtrade_value }
							check_variable = { resource_imported@steel > 0 }
						}
						get_sorted_scored_countries_temp = {
							scorer = best_trader_steel_scorer  
							array  = tags
							scores = resources
						}

						for_each_loop = {
							array = tags
							value = trader
							break = break
							meta_effect = {
								text = {
									create_import = {
										resource = steel
										amount = 0
										exporter = [EXPORTER]
									}											
								}
								EXPORTER = "[?trader.GetTag]"
							}
						}				
					}

					# CHROMIUM
					set_temp_variable = { overtrade_value = 7 }
					set_temp_variable = { net_residual_resource = resource_produced@chromium }
					subtract_from_temp_variable = { net_residual_resource = resource_consumed@chromium }
					subtract_from_temp_variable = { net_residual_resource = resource_exported@chromium }

					every_subject_country = {
						if = {
                            limit = {
                                or = {
                                    has_autonomy_state = autonomy_collaboration_government
                                    has_autonomy_state = autonomy_reichskommissariat
                                }
                                check_variable = { resource_exported@chromium > 0 }
                                check_variable = { net_residual_resource > -80 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 87 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
                        if = {
                            limit = {
                                has_autonomy_state = autonomy_dominion
                                check_variable = { resource_exported@chromium > 0 }
                                check_variable = { net_residual_resource > -16 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 23 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
                        if = {
                            limit = {
                                has_autonomy_state = autonomy_satellite
                                check_variable = { resource_exported@chromium > 0 }
                                check_variable = { net_residual_resource > -10 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 17 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
					}
					if = {
						limit = {
							check_variable = { resource@chromium > overtrade_value }
							check_variable = { resource_imported@chromium > 0 }
						}
						get_sorted_scored_countries_temp = {
							scorer = best_trader_chromium_scorer  
							array  = tags
							scores = resources
						}

						for_each_loop = {
							array = tags
							value = trader
							break = break
							meta_effect = {
								text = {
									create_import = {
										resource = chromium
										amount = 0
										exporter = [EXPORTER]
									}											
								}
								EXPORTER = "[?trader.GetTag]"
							}
						}				
					}

					# COAL
					set_temp_variable = { overtrade_value = 7 }
					set_temp_variable = { net_residual_resource = resource_produced@coal }
					subtract_from_temp_variable = { net_residual_resource = resource_consumed@coal }
					subtract_from_temp_variable = { net_residual_resource = resource_exported@coal }

					every_subject_country = {
						if = {
                            limit = {
                                or = {
                                    has_autonomy_state = autonomy_collaboration_government
                                    has_autonomy_state = autonomy_reichskommissariat
                                }
                                check_variable = { resource_exported@coal > 0 }
                                check_variable = { net_residual_resource > -80 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 87 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
                        if = {
                            limit = {
                                has_autonomy_state = autonomy_dominion
                                check_variable = { resource_exported@coal > 0 }
                                check_variable = { net_residual_resource > -16 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 23 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
                        if = {
                            limit = {
                                has_autonomy_state = autonomy_satellite
                                check_variable = { resource_exported@coal > 0 }
                                check_variable = { net_residual_resource > -10 }
                            }
                            set_temp_variable = { temp_overtrade_value = net_residual_resource }
                            add_to_temp_variable = { temp_overtrade_value = 17 }

                            if = {
                                limit = {
                                    check_variable = { temp_overtrade_value > overtrade_value }
                                }
                                set_temp_variable = { overtrade_value = temp_overtrade_value }
                            }
                        }
					}
					if = {
						limit = {
							check_variable = { resource@coal > overtrade_value }
							check_variable = { resource_imported@coal > 0 }
						}
						get_sorted_scored_countries_temp = {
							scorer = best_trader_coal_scorer  
							array  = tags
							scores = resources
						}

						for_each_loop = {
							array = tags
							value = trader
							break = break
							meta_effect = {
								text = {
									create_import = {
										resource = coal
										amount = 0
										exporter = [EXPORTER]
									}											
								}
								EXPORTER = "[?trader.GetTag]"
							}
						}				
					}
				}
            }
		}
	}
}